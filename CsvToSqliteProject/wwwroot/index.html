<!DOCTYPE html>
<html>
<head>
    <title>bun so chia</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 1200px; width: 100%; }
        .controls { padding: 10px; background: #f4f4f4; }
    </style>
</head>
<body>
    <div class="controls">
        <input type="text" id="carInput" placeholder="input car pai (Ex. 076-UY)">
        <button onclick="loadData()">shake</button>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([24.974, 121.738], 13); // 以坪林為中心
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        var markers = L.layerGroup().addTo(map);

        async function loadData() {
            const carId = document.getElementById('carInput').value;
            const url = carId ? `/api/cars/${carId}` : '/api/cars';
            
            const response = await fetch(url);
            const data = await response.json();
            
            markers.clearLayers();
            data.forEach(item => {
                L.marker([item.latitude, item.longitude])
                 .bindPopup(`<b>car pai:</b> ${item.car}<br><b>Time:</b> ${item.time}<br><b>Location:</b> ${item.location}`)
                 .addTo(markers);
            });
        }
        loadData(); // 初始載入
    </script>
</body>
</html>